local players = game:GetService("Players")
local player  = players.LocalPlayer

local ESP = {
    playerAddedConnection = nil,
    characterAddedConnection = nil,

    settings = {
        teamCheck = true,

        fillC = nil,
        outlineC = nil,
        fillT = nil
    }
}

getgenv().espEnabled = true

function ESP.onAdded(char)
    ESP.Draw(char,ESP.settings)
end 

function ESP.clean()
    getgenv().espEnabled = false 

    if ESP.playerAddedConnection then 
        ESP.playerAddedConnection:Disconnect()
        warn("ESP Connection Disconnected")
    end    

    if ESP.characterAddedConnection then 
        ESP.characterAddedConnection:Disconnect()
        warn("ESP Connection Disconnected")
    end 

    for i,v in players:GetPlayers() do 
        if v ~= player and v.Character and v.Character:FindFirstChild("Nigger") then 
            v.Character.Nigger:Remove()
            warn("ESP Cleaned in " .. v.Name)
        end 
    end 
end

function ESP.Draw(char,settings)
    local highlight = Instance.new("Highlight")
    highlight.Parent = char
    highlight.FillColor = settings.fillC or Color3.new(0.019607, 0.670588, 0.815686)
    highlight.OutlineColor = settings.outlineC or Color3.new(0,1,0)
    highlight.FillTransparency = settings.fillT or 0
    highlight.Name = "Nigger"
    
end

function ESP.teamCheck(char)
    if ESP.settings.teamCheck then 
        if char.Parent == "IIoooIIl" then --defender
            return "defender"
        elseif char.Parent == "lIIooolll" then -- attackers
            return "attacker"
        end 
    end 
end



function ESP.Init()
    warn("Esp Init")
    getgenv().espEnabled = true

    ESP.playerAddedConnection = players.PlayerAdded:Connect(function(p)
        ESP.characterAddedConnection = p.CharacterAdded:Connect(ESP.onAdded)
    end)

    while getgenv().espEnabled do task.wait(1)
        if not getgenv().espEnabled then ESP.clean() return end 

        for i,v in players:GetPlayers() do 
            if v ~= player and v.Character and v.Character:FindFirstChild("Nigger") == nil then 
                local vTeam = ESP.teamCheck(v.Character)
                local myTeam = ESP.teamCheck(player.Character)

                if vTeam == "defender" and myTeam == "defender" and ESP.settings.teamCheck then 
                    ESP.settings = {
                        fillC = Color3.new(0, 0.988235, 0.031372),
                        outlineC = Color3.new(0.027450, 0.243137, 0.023529),
                        fillT = 0.5
                    }
                else 
                    ESP.settings = {
                        fillC = Color3.new(0.988235, 0, 0),
                        outlineC = Color3.new(0.243137, 0.023529, 0.023529),
                        fillT = 0.5
                    }
                end 

                ESP.Draw(v.Character,ESP.settings)
            end 
        end 

    end 
end

return ESP 
